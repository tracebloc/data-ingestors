apiVersion: batch/v1
kind: Job
metadata:
  name: ingestor-job-train-data # train/test switch
  namespace: tracebloc-templates
spec:
  template:
    spec:
      containers:
      - name: api
        image: tracebloc/heart-failure-clinical-data-ingestor:latest # train/test switch
        imagePullPolicy: Always
        volumeMounts:
          - name: shared-volume
            mountPath: "/data/shared/" # Storage path within the client cluster (not the ingestor path). The data ingestor will copy all images and text files to that location.
        env:
        # Client credentials 
        - name: CLIENT_ENV
          value: "dev"
        - name: CLIENT_ID
          value: "08ec78b9-871c-4fe1-8414-6a0ab3d268e3"
        - name: CLIENT_PASSWORD
          value: "2unfcsowu4fh!8Uxz23fj"
        - name: CLIENT_PVC
          value: "client-pvc"
        - name: MYSQL_HOST
          value: "mysql-client"
        - name: SRC_PATH
          value: "/data/shared" # Source folder path whithin the data ingestor
        - name: LABEL_FILE
          value: "/data/shared/heart_failure_clinical_records_dataset.csv" # train/test switch
        - name: TABLE_NAME
          value: "heart_failure_train_data" # train/test switch
        - name: TITLE
          value: "Heart failure train data" # Optional: provide a title for the dataset
        - name: LOG_LEVEL
          value: "WARNING"
      imagePullSecrets:
      - name: regcred
      nodeSelector:
        type: system
      volumes:
        - name: shared-volume
          persistentVolumeClaim:
            claimName: client-pvc # value has to match the shared data PVC name in the client values.yaml
      restartPolicy: Never
